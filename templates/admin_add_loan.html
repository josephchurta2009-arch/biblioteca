{% extends "base.html" %}

{% block title %}Agregar Préstamo - {{ super() }}{% endblock %}

{% block content %}
<h2>Agregar Préstamo</h2>

<form method="POST">
    <div class="mb-3">
    <label for="user_id" class="form-label">Seleccionar Usuario</label>
    <select name="user_id" id="user_id" class="form-select select2" required>
        <option value="">Buscar...</option>  <!-- ESTA LÍNEA ES CLAVE -->
        {% for user in users %}
            <option value="{{ user.id }}">
                {{ user.full_name }} - {{ user.username }} - {{ user.email }}
            </option>
        {% endfor %}
    </select>
</div>


  <div class="mb-3">
    <label for="book_id" class="form-label">Seleccionar Libro</label>
    <select name="book_id" id="book_id" class="form-select select2" required>
        <option value="">Buscar...</option>  <!-- ESTA LÍNEA TAMBIÉN -->
        {% for book in books %}
            <option value="{{ book.id }}">
                {{ book.title }} - {{ book.author }} ({{ book.available_copies }} disponibles)
            </option>
        {% endfor %}
    </select>
</div>


    <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> Confirmar Préstamo</button>
    <a href="{{ url_for('manage_loans') }}" class="btn btn-secondary">Cancelar</a>
</form>
{% endblock %}

{% block scripts %}
<!-- Select2: Inicialización con placeholder para campo interno -->
<script>
  $(document).ready(function() {
    $('.select2').select2({
      width: '100%',
      placeholder: "Selecciona una opción",
      allowClear: true,
      language: {
        searching: function() {
          return "Buscando...";
        },
        inputTooShort: function() {
          return "Buscar...";
        },
        noResults: function() {
          return "No se encontraron resultados";
        }
      }
    });

    // Esperar a que el dropdown abra para insertar el placeholder
    $('.select2').on('select2:open', function () {
      setTimeout(() => {
        $('.select2-container--open .select2-search__field').attr('placeholder', 'Buscar...');
      }, 0);
    });
  });
</script>
{% endblock %}
