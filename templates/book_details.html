{% extends "base.html" %}

{% block title %}{{ book.title }} - {{ super() }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 mb-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('book_search') }}">Libros</a></li>
                <li class="breadcrumb-item active">{{ book.title }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">{{ book.title }}</h1>
                <h5 class="card-subtitle mb-3 text-muted">por {{ book.author }}</h5>
                
                <div class="row mb-3">
                    <div class="col-sm-6">
                        {% if book.isbn %}
                            <p><strong>ISBN:</strong> {{ book.isbn }}</p>
                        {% endif %}
                        {% if book.publisher %}
                            <p><strong>Editorial:</strong> {{ book.publisher }}</p>
                        {% endif %}
                    </div>
                    <div class="col-sm-6">
                        {% if book.publication_year %}
                            <p><strong>Año de Publicación:</strong> {{ book.publication_year }}</p>
                        {% endif %}
                        {% if book.category %}
                            <p><strong>Categoría:</strong> {{ book.category }}</p>
                        {% endif %}
                    </div>
                </div>
                
                {% if book.description %}
                    <div class="mb-3">
                        <h6>Descripción</h6>
                        <p class="text-muted">{{ book.description }}</p>
                    </div>
                {% endif %}
                
                <div class="mb-3">
                    <h6>Disponibilidad</h6>
                    <p>
                        <span class="badge {% if book.is_available %}bg-success{% else %}bg-danger{% endif %} me-2">
                            {% if book.is_available %}
                                Disponible
                            {% else %}
                                No disponible
                            {% endif %}
                        </span>
                        {{ book.available_copies }} de {{ book.total_copies }} copias disponibles
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-cog"></i> Acciones</h6>
            </div>
            <div class="card-body">
                {% if current_user.is_admin %}
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('edit_book', book_id=book.id) }}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> Editar Libro
                        </a>
                        <form method="POST" action="{{ url_for('delete_book', book_id=book.id) }}" 
                              onsubmit="return confirm('¿Estás seguro de que quieres eliminar este libro?')">
                            <button type="submit" class="btn btn-danger w-100">
                                <i class="fas fa-trash"></i> Eliminar Libro
                            </button>
                        </form>
                    </div>
                {% else %}
                    {% if user_loan %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Ya tienes este libro en préstamo.
                            <small class="d-block mt-1">
                                Vence: {{ user_loan.due_date.strftime('%d/%m/%Y') }}
                            </small>
                        </div>
                        <form method="POST" action="{{ url_for('return_book', loan_id=user_loan.id) }}">
                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-undo"></i> Devolver Libro
                            </button>
                        </form>
                    {% elif book.is_available %}
                        <form method="POST" action="{{ url_for('loan_book', book_id=book.id) }}">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-book-reader"></i> Solicitar Préstamo
                            </button>
                        </form>
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-info-circle"></i> 
                            Período de préstamo: 14 días
                        </small>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            Este libro no está disponible actualmente.
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        
        {% if current_user.is_admin %}
        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-chart-bar"></i> Estadísticas</h6>
            </div>
            <div class="card-body">
                <p class="mb-1"><strong>Total de copias:</strong> {{ book.total_copies }}</p>
                <p class="mb-1"><strong>Disponibles:</strong> {{ book.available_copies }}</p>
                <p class="mb-0"><strong>En préstamo:</strong> {{ book.total_copies - book.available_copies }}</p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
